<?xml version="1.0"?>

<!-- This program is free software; you can redistribute it and/or
  modify it under the terms of the GNU General Public License
  as published by the Free Software Foundation, version 2
  of the License.
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place - Suite 330, Boston,
  MA 02111-1307, USA. -->

<!-- ===================================================================== -->
<!-- TUER                                                                  -->
<!-- Ant 1.8 build file                                                    -->
<!-- ===================================================================== -->

<project name="TUER" default="build" basedir="." xmlns:redline="antlib:org.redline_rpm">
	<!-- external tasks -->
	<taskdef resource="net/jtools/classloadertask/antlib.xml" classpath="lib/ant/ant-classloadertask.jar"/>
	<taskdef resource="net/sf/antcontrib/antlib.xml" classpath="lib/ant/ant-contrib-1.0b3.jar"/>
	<taskdef resource="org/redline_rpm/antlib.xml" classpath="lib/ant/redline-1.1.15.jar"/>
	<taskdef resource="antlib.xml" classpath="lib/ant/jpkg-combined.jar"/>
	<!-- Properties -->
	<property name="bindir" value="."/>
	<!-- directory containing signed JARs, JNPL files and images that are used in the deployed product -->
	<property name="destdir" value="target"/>
	<!-- directory containing the source code -->
	<property name="srcdir" value="."/>
	<property name="homepage-url" value="http://tuer.sourceforge.net" />
	<property name="codebase-url" value="${homepage-url}/very_experimental/" />
	<property name="vendor" value="Julien GOUESSE" />
	<property name="alias" value="gouessej"/>
	<property name="keystore" value="${destdir}/key"/>
	<property name="tuer-application-name" value="Truly Unusual Experience of Revolution"/>
	<property name="tuer-main-class" value="engine.service.Ardor3DGameServiceProvider"/>
	<property name="tuer-jnlp-filename" value="tuer.jnlp" />
	<property name="tuer-jar-filename" value="tuer.jar" />
	<property name="tuer-zip-filename" value="tuer.zip" />
	<property name="ardor3d-version" value="1.0-SNAPSHOT" />
	<property name="jfpsm-application-name" value="Java First Person Shooter Maker"/>
	<property name="jfpsm-main-class" value="connection.JFPSMServiceProvider"/>
	<property name="jfpsm-splashscreen-image" value="images/jfpsm_splashscreen.png"/>
	<property name="jfpsm-jnlp-filename" value="jfpsm.jnlp" />
	<property name="jfpsm-jar-filename" value="jfpsm.jar" />
	<!-- example of value for an archived post build: http://jogamp.org/deployment/archive/master/gluegen_737-joal_492-jogl_1120-jocl_867/jar -->
	<!-- example of value for the current release or release candidate: http://jogamp.org/deployment/jogamp-current/jar/orig -->
	<!-- example of value for a released version: http://jogamp.org/deployment/v2.1.1/jar -->
	<property name="jogamp-unsigned-jars-url" value="http://jogamp.org/deployment/archive/master/gluegen_771-joal_520-jogl_1217-jocl_923/jar" />
	<!-- Sourceforge username -->
	<property name="sftp-userid" value="gouessej" />
	<!-- Sourceforge Project Web space -->
	<property name="sftp-server" value="web.sourceforge.net" />
	<property name="sftp-remotedir" value="/home/project-web/tuer/htdocs/very_experimental" />
	<!-- Sourceforge Project file releases -->
	<property name="sftp-pfs-server" value="frs.sourceforge.net" />
	<property name="sftp-pfs-remotedir" value="/home/pfs/project/tuer/tuer/" />
	<path id="project.lib.path">
		<pathelement location="lib/ardor3d/ardor3d-collada-${ardor3d-version}.jar"/>
		<pathelement location="lib/ardor3d/ardor3d-core-${ardor3d-version}.jar"/>
		<pathelement location="lib/ardor3d/ardor3d-math-${ardor3d-version}.jar"/>
		<pathelement location="lib/ardor3d/ardor3d-savable-${ardor3d-version}.jar"/>
		<pathelement location="lib/ardor3d/ardor3d-extras-${ardor3d-version}.jar"/>
		<pathelement location="lib/ardor3d/ardor3d-jogl-${ardor3d-version}.jar"/>
		<pathelement location="lib/ardor3d/ardor3d-ui-${ardor3d-version}.jar"/>
		<pathelement location="lib/fettle/fettle-0.7.0.jar"/>
		<pathelement location="lib/google-collect/guava-14.0.1.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt.jar"/>
		<pathelement location="lib/joal/joal.jar"/>
		<pathelement location="lib/jogl/jogl-all.jar"/>
		<pathelement location="lib/pss/CodecJOrbis.jar"/>
		<pathelement location="lib/pss/LibraryJavaSound.jar"/>
		<pathelement location="lib/pss/LibraryJOAL.jar"/>
		<pathelement location="lib/pss/SoundSystem.jar"/>
	</path>
	<path id="project.class.path">
		<!-- N.B: do not add java.class.path -->
		<pathelement path="${bindir}"/>
		<path refid="project.lib.path"/>
	</path>
	<path id="jogamp.natives.path">
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-linux-amd64.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-linux-i586.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-solaris-amd64.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-solaris-i586.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-macosx-universal.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-windows-amd64.jar"/>
		<pathelement location="lib/gluegen-rt/gluegen-rt-natives-windows-i586.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-linux-amd64.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-linux-i586.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-solaris-amd64.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-solaris-i586.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-macosx-universal.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-windows-amd64.jar"/>
		<pathelement location="lib/jogl/jogl-all-natives-windows-i586.jar"/>
		<pathelement location="lib/joal/joal-natives-linux-amd64.jar"/>
		<pathelement location="lib/joal/joal-natives-linux-i586.jar"/>
		<pathelement location="lib/joal/joal-natives-solaris-amd64.jar"/>
		<pathelement location="lib/joal/joal-natives-solaris-i586.jar"/>
		<pathelement location="lib/joal/joal-natives-macosx-universal.jar"/>
		<pathelement location="lib/joal/joal-natives-windows-amd64.jar"/>
		<pathelement location="lib/joal/joal-natives-windows-i586.jar"/>
	</path>
	<!-- TODO use a flatten mapper to build this path (project.lib.path + jogamp.natives.path + tuer + jfpsm) -->
	<path id="project.signed.jars.path">
		<pathelement location="${destdir}/fettle-0.7.0.jar" />
		<pathelement location="${destdir}/guava-14.0.1.jar" />
		<pathelement location="${destdir}/ardor3d-collada-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/ardor3d-core-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/ardor3d-math-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/ardor3d-savable-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/ardor3d-extras-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/ardor3d-jogl-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/ardor3d-ui-${ardor3d-version}.jar" />
		<pathelement location="${destdir}/${tuer-jar-filename}"/>
		<pathelement location="${destdir}/${jfpsm-jar-filename}"/>
		<pathelement location="${destdir}/CodecJOrbis.jar"/>
		<pathelement location="${destdir}/LibraryJavaSound.jar"/>
		<pathelement location="${destdir}/LibraryJOAL.jar"/>
		<pathelement location="${destdir}/SoundSystem.jar"/>
		<pathelement location="${destdir}/jogl-all.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-linux-amd64.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-linux-i586.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-solaris-amd64.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-solaris-i586.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-macosx-universal.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-windows-amd64.jar"/>
		<pathelement location="${destdir}/jogl-all-natives-windows-i586.jar"/>
		<pathelement location="${destdir}/joal.jar"/>
		<pathelement location="${destdir}/joal-natives-linux-amd64.jar"/>
		<pathelement location="${destdir}/joal-natives-linux-i586.jar"/>
		<pathelement location="${destdir}/joal-natives-solaris-amd64.jar"/>
		<pathelement location="${destdir}/joal-natives-solaris-i586.jar"/>
		<pathelement location="${destdir}/joal-natives-macosx-universal.jar"/>
		<pathelement location="${destdir}/joal-natives-windows-amd64.jar"/>
		<pathelement location="${destdir}/joal-natives-windows-i586.jar"/>
		<pathelement location="${destdir}/gluegen-rt.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-linux-amd64.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-linux-i586.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-solaris-amd64.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-solaris-i586.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-macosx-universal.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-windows-amd64.jar"/>
		<pathelement location="${destdir}/gluegen-rt-natives-windows-i586.jar"/>
	</path>
	<macrodef name="override-permissions-and-codebase-manifest-attributes">
		<attribute name="jar" />
		<sequential>
			<!-- extracts the manifest from the jar -->
			<unzip src="@{jar}" dest="${destdir}">
				<patternset>
					<include name="META-INF/MANIFEST.MF" />
				</patternset>
			</unzip>
			<!-- updates the manifest -->
			<manifest mode="update" file="${destdir}/META-INF/MANIFEST.MF">
				<attribute name="Trusted-Only" value="true"/>
				<attribute name="Trusted-Library" value="false"/>
				<attribute name="Permissions" value="all-permissions" />
				<attribute name="Codebase" value="${codebase-url}" />
			</manifest>
			<!-- updates the JAR -->
			<jar update="true" destFile="@{jar}" manifest="${destdir}/META-INF/MANIFEST.MF" />
			<!-- deletes the temporary manifest -->
			<delete file="${destdir}/META-INF/MANIFEST.MF" />
			<delete dir="${destdir}/META-INF" />
		</sequential>
	</macrodef>
	<macrodef name="create-jogamp-fatjar">
		<attribute name="gluegen-rt-jars-dir" />
		<attribute name="joal-jars-dir" />
		<attribute name="jogl-jars-dir" />
		<attribute name="dest" />
		<sequential>
			<delete file="@{dest}" failonerror="false" />
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-linux-i586.jar" dest="@{gluegen-rt-jars-dir}/natives/linux-i586">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-linux-amd64.jar" dest="@{gluegen-rt-jars-dir}/natives/linux-amd64">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-macosx-universal.jar" dest="@{gluegen-rt-jars-dir}/natives/macosx-universal">
				<patternset>
					<include name="*.dylib" />
				</patternset>
			</unzip>
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-solaris-i586.jar" dest="@{gluegen-rt-jars-dir}/natives/solaris-i586">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-solaris-amd64.jar" dest="@{gluegen-rt-jars-dir}/natives/solaris-amd64">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-windows-i586.jar" dest="@{gluegen-rt-jars-dir}/natives/windows-i586">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{gluegen-rt-jars-dir}/gluegen-rt-natives-windows-amd64.jar" dest="@{gluegen-rt-jars-dir}/natives/windows-amd64">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-linux-i586.jar" dest="@{joal-jars-dir}/natives/linux-i586">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-linux-amd64.jar" dest="@{joal-jars-dir}/natives/linux-amd64">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-macosx-universal.jar" dest="@{joal-jars-dir}/natives/macosx-universal">
				<patternset>
					<include name="*.dylib" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-solaris-i586.jar" dest="@{joal-jars-dir}/natives/solaris-i586">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-solaris-amd64.jar" dest="@{joal-jars-dir}/natives/solaris-amd64">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-windows-i586.jar" dest="@{joal-jars-dir}/natives/windows-i586">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{joal-jars-dir}/joal-natives-windows-amd64.jar" dest="@{joal-jars-dir}/natives/windows-amd64">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-linux-i586.jar" dest="@{jogl-jars-dir}/natives/linux-i586">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-linux-amd64.jar" dest="@{jogl-jars-dir}/natives/linux-amd64">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-macosx-universal.jar" dest="@{jogl-jars-dir}/natives/macosx-universal">
				<patternset>
					<include name="*.dylib" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-solaris-i586.jar" dest="@{jogl-jars-dir}/natives/solaris-i586">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-solaris-amd64.jar" dest="@{jogl-jars-dir}/natives/solaris-amd64">
				<patternset>
					<include name="*.so" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-windows-i586.jar" dest="@{jogl-jars-dir}/natives/windows-i586">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<unzip src="@{jogl-jars-dir}/jogl-all-natives-windows-amd64.jar" dest="@{jogl-jars-dir}/natives/windows-amd64">
				<patternset>
					<include name="*.dll" />
				</patternset>
			</unzip>
			<zip destfile="@{dest}">
				<zipgroupfileset dir="@{gluegen-rt-jars-dir}" includes="*.jar" excludes="*-natives-*.jar" />
				<zipgroupfileset dir="@{joal-jars-dir}" includes="*.jar" excludes="*-natives-*.jar" />
				<zipgroupfileset dir="@{jogl-jars-dir}" includes="*.jar" excludes="*-natives-*.jar" />
				<zipfileset dir="@{gluegen-rt-jars-dir}" includes="**/*.so" />
				<zipfileset dir="@{gluegen-rt-jars-dir}" includes="**/*.dylib" />
				<zipfileset dir="@{gluegen-rt-jars-dir}" includes="**/*.dll" />
				<zipfileset dir="@{joal-jars-dir}" includes="**/*.so" />
				<zipfileset dir="@{joal-jars-dir}" includes="**/*.dylib" />
				<zipfileset dir="@{joal-jars-dir}" includes="**/*.dll" />
				<zipfileset dir="@{jogl-jars-dir}" includes="**/*.so" />
				<zipfileset dir="@{jogl-jars-dir}" includes="**/*.dylib" />
				<zipfileset dir="@{jogl-jars-dir}" includes="**/*.dll" />
			</zip>
			<delete dir="@{gluegen-rt-jars-dir}/natives" />
			<delete dir="@{joal-jars-dir}/natives" />
			<delete dir="@{jogl-jars-dir}/natives" />
		</sequential>
	</macrodef>
	<target name="create-jogamp-fatjar">
		<create-jogamp-fatjar gluegen-rt-jars-dir="lib/gluegen-rt" joal-jars-dir="lib/joal" jogl-jars-dir="lib/jogl" dest="${destdir}/jogamp.jar" />
	</target>
	<target name="check-java-version" description="Checks the Java version">
		<fail message="Please use Java SDK 1.7 or higher.">
			<condition>
				<not>
					<or>
						<equals arg1="${ant.java.version}" arg2="1.7" />
						<equals arg1="${ant.java.version}" arg2="1.8" />
					</or>
				</not>
			</condition>
		</fail>
	</target>
	<!-- ================================================================= -->
	<!-- Upgrade JogAmp                                                    -->
	<!-- ================================================================= -->
	<target name="upgrade-jogamp" description="Upgrades JogAmp">
		<!-- updates the local files -->
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-linux-amd64.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-linux-i586.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-macosx-universal.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-solaris-amd64.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-solaris-i586.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-windows-amd64.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/gluegen-rt-natives-windows-i586.jar" dest="lib/gluegen-rt" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-linux-amd64.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-linux-i586.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-macosx-universal.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-solaris-amd64.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-solaris-i586.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-windows-amd64.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/joal-natives-windows-i586.jar" dest="lib/joal" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-linux-amd64.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-linux-i586.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-macosx-universal.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-solaris-amd64.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-solaris-i586.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-windows-amd64.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
		<get src="${jogamp-unsigned-jars-url}/jogl-all-natives-windows-i586.jar" dest="lib/jogl" verbose="true" usetimestamp="true" skipexisting="false" />
	</target>
	<!-- ================================================================= -->
	<!-- Compile                                                           -->
	<!-- ================================================================= -->
	<target name="compile" description="Compiles the source code">
		<javac includeantruntime="false" srcdir="${srcdir}"       	   
	           destdir="${bindir}"
	           debug="on" >
			<classpath refid="project.class.path"/>
			<include name="**/*.java"/>
		</javac>
	</target>
	<!-- =================================================================== -->
	<!-- Build                                                               -->
	<!-- =================================================================== -->
	<target name="build" depends="clean,compile,dist" description="Performs a clean build of the source code and deploys the application"/>
	<!-- ================================================================= -->
	<!-- Dist                                                              -->
	<!-- ================================================================= -->
	<target name="dist" depends="compile" description="Creates the deployable files and uploads them onto the server(s)">
		<!-- Creates the JARs of the applications and prepares the JARs of the libraries -->
		<antcall target="create-jars" />
		<antcall target="prepare-third-party-jars" />
		<!-- Signs them -->
		<antcall target="sign-jars" />
		<!-- Creates the JNLP files used by the end users to run the application with Java Web Start -->
		<antcall target="create-jnlp-files" />
		<!-- Deletes the archive to avoid getting an error when trying to compress itself and creates it -->
		<antcall target="create-archive" />
		<!-- Sends all stuffs to the server(s) -->
		<antcall target="upload" />
	</target>
	<!-- ================================================================= -->
	<!-- Create JARs                                                       -->
	<!-- ================================================================= -->
	<target name="create-jars">
		<jar destfile="${destdir}/${jfpsm-jar-filename}" basedir="${bindir}" 
			includes="**/*.class" 
			compress="false">
			<exclude name="**/gpl.txt" />
			<!-- the collada models are not yet used -->
			<exclude name="**/dae/*" />
			<!-- ANT file -->
			<exclude name="**/build.xml" />
			<exclude name="**/*.py" />
			<manifest>
				<attribute name="Application-Name" value="${jfpsm-application-name}"/>
				<attribute name="Main-Class" value="${jfpsm-main-class}"/>
				<attribute name="SplashScreen-Image" value="${jfpsm-splashscreen-image}"/>
				<attribute name="Trusted-Only" value="true"/>
				<attribute name="Trusted-Library" value="false"/>
				<attribute name="Permissions" value="all-permissions"/>
				<attribute name="Codebase" value="${codebase-url}"/>
			</manifest>
		</jar>
		<jar destfile="${destdir}/${tuer-jar-filename}" basedir="${bindir}" 
			includes="**/*.class"
			compress="false">
			<include name="**/*.bmp" />
			<include name="**/*.png" />
			<include name="**/*.jpg" />
			<include name="**/*.fnt" />
			<include name="**/controls.txt" />
			<include name="**/credits.txt" />
			<include name="**/sounds/*.ogg" />
			<!-- TUER does not need JFPSM classes -->
			<exclude name="**/jfpsm/*.class" />
			<exclude name="**/connection/*.class" />
			<!-- the collada models -->
			<!--<include name="**/dae/*.dae" />-->
			<include name="**/abin/*.abin" />
			<exclude name="**/gpl.txt" />
			<!-- ANT file -->
			<exclude name="**/build.xml" />
			<exclude name="**/*.py" />
			<!-- miscellaneous libraries -->
			<exclude name="**/lib/**" />
			<manifest>
				<attribute name="Application-Name" value="${tuer-application-name}"/>
				<attribute name="Main-Class" value="${tuer-main-class}"/>
				<attribute name="Trusted-Only" value="true"/>
				<attribute name="Trusted-Library" value="false"/>
				<attribute name="Permissions" value="all-permissions"/>
				<attribute name="Codebase" value="${codebase-url}"/>
			</manifest>
		</jar>
	</target>
	<!-- ================================================================= -->
	<!-- Prepare third party JARs                                          -->
	<!-- ================================================================= -->
	<target name="prepare-third-party-jars">
		<!-- copies these JARs into the local destination directory (to avoid mixing unsigned JARs with signed JARs) -->
		<copy todir="${destdir}" flatten="true" overwrite="true">
			<path refid="project.lib.path" />
			<!-- copies these JARs to host JOGL, JOAL and GlueGen (instead of using JogAmp signed JARs hosted on its servers) -->
			<path refid="jogamp.natives.path" />
		</copy>
		<!-- repurposes the JARs of the third party libraries, overrides the permissions and codebase manifest attributes -->
		<for param="file">
			<path refid="project.signed.jars.path"/>
			<sequential>
				<override-permissions-and-codebase-manifest-attributes jar="@{file}" />
			</sequential>
		</for>
	</target>
	<!-- ================================================================= -->
	<!-- Sign JARs                                                         -->
	<!-- ================================================================= -->
	<target name="sign-jars">
		<!-- deletes the keystore if any -->
		<delete file="${keystore}" failonerror="false" />
		<!-- gets the storepass -->
		<input message="Please enter the store pass:" addproperty="storepass" />
		<!-- creates the keystore -->
		<genkey alias="${alias}" storepass="${storepass}" keystore="${keystore}">
			<dname>
				<param name="CN" value="${vendor}"/>
				<param name="OU" value="Engineer"/>
				<param name="O"  value="FGF"/>
				<param name="C"  value="FR"/>
				<param name="L"  value="BAGNOLET"/>
				<param name="S"  value="FRANCE"/>
			</dname>
		</genkey>
		<!-- uses this keystore to sign the JARs -->
		<signjar alias="${alias}" keystore="${keystore}" storepass="${storepass}" lazy="false" destDir="${destdir}" tsaurl="http://timestamping.edelweb.fr/service/tsp">
			<path refid="project.signed.jars.path"/>
		</signjar>
		<!-- deletes the keystore if any -->
		<delete file="${keystore}" failonerror="false" />
	</target>
	<!-- ================================================================= -->
	<!-- Create JNLP files                                                 -->
	<!-- ================================================================= -->
	<target name="create-jnlp-files">
		<!-- generate the JNLP files used by Java Web Start -->
		<echo file="${destdir}/${tuer-jnlp-filename}">
			<![CDATA[<?xml version="1.0" encoding="utf-8"?>
			<jnlp spec="1.0+" codebase="${codebase-url}" href="${tuer-jnlp-filename}">
				<information>
					<title>${tuer-application-name}</title>
					<vendor>${vendor}</vendor>
					<homepage href="${homepage-url}"/>
					<description>Small Quake-like written in Java + JOGL</description>
					<description kind="short">kill them all!!</description>
					<icon kind="default" href="tuerLogo.png"/>
					<icon kind="splash" href="tuerLogo.png"/>
			        <icon kind="shortcut" href="tuerLogo.png"/>
	                <shortcut online="false" install="true">
	                    <desktop/>
	                    <menu submenu="Games"/>
	                </shortcut>
					<offline-allowed/>
				</information>
				<security>
					<all-permissions />
				</security>
				<update check="always" policy="always"/>
				<resources>
					<j2se version="1.7+" href="http://java.sun.com/products/autodl/j2se" initial-heap-size="32m" max-heap-size="256m" java-vm-args="-XX:MaxDirectMemorySize=128M"/>
					<property name="sun.nio.MaxDirectMemorySize" value="128M"/>
					<property name="sun.java2d.noddraw" value="true"/>
					<property name="sun.java2d.d3d" value="false"/>
					<property name="sun.java2d.opengl" value="false"/>
			        <property name="java.ext.dirs" value="" />
					<jar href="${tuer-jar-filename}" download="eager" main="true"/>
					<jar href="ardor3d-collada-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-core-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-math-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-savable-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-extras-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-jogl-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-ui-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="fettle-0.7.0.jar" download="eager" main="false"/>
					<jar href="guava-14.0.1.jar" download="eager" main="false"/>
					<jar href="CodecJOrbis.jar" download="eager" main="false"/>
					<jar href="LibraryJavaSound.jar" download="eager" main="false"/>
					<jar href="LibraryJOAL.jar" download="eager" main="false"/>
					<jar href="SoundSystem.jar" download="eager" main="false"/>
					<jar href="gluegen-rt.jar" download="eager" main="false"/>
					<jar href="joal.jar" download="eager" main="false"/>
					<jar href="jogl-all.jar" download="eager" main="false"/>
				</resources>
				<resources os="Linux" arch="i386">
					<jar href="joal-natives-linux-i586.jar" />
					<jar href="jogl-all-natives-linux-i586.jar" />
					<jar href="gluegen-rt-natives-linux-i586.jar" />
				</resources>
				<resources os="Linux" arch="x86">
					<jar href="joal-natives-linux-i586.jar" />
					<jar href="jogl-all-natives-linux-i586.jar" />
					<jar href="gluegen-rt-natives-linux-i586.jar" />
				</resources>
				<resources os="Linux" arch="amd64">
					<jar href="joal-natives-linux-amd64.jar" />
					<jar href="jogl-all-natives-linux-amd64.jar" />
					<jar href="gluegen-rt-natives-linux-amd64.jar" />
				</resources>
				<resources os="Linux" arch="x86_64">
					<jar href="joal-natives-linux-amd64.jar" />
					<jar href="jogl-all-natives-linux-amd64.jar" />
					<jar href="gluegen-rt-natives-linux-amd64.jar" />
				</resources>
				<resources os="SunOS" arch="sparc">
					<jar href="joal-natives-solaris-sparc.jar" />
					<jar href="jogl-all-natives-solaris-sparc.jar" />
					<jar href="gluegen-rt-natives-solaris-sparc.jar" />
				</resources>
				<resources os="SunOS" arch="sparcv9">
					<jar href="joal-natives-solaris-sparcv9.jar" />
					<jar href="jogl-all-natives-solaris-sparcv9.jar" />
					<jar href="gluegen-rt-natives-solaris-sparcv9.jar" />
				</resources>
				<resources os="SunOS" arch="x86">
					<jar href="joal-natives-solaris-i586.jar" />
					<jar href="jogl-all-natives-solaris-i586.jar" />
					<jar href="gluegen-rt-natives-solaris-i586.jar" />
				</resources>
				<resources os="SunOS" arch="amd64">
					<jar href="joal-natives-solaris-amd64.jar" />
					<jar href="jogl-all-natives-solaris-amd64.jar" />
					<jar href="gluegen-rt-natives-solaris-amd64.jar" />
				</resources>
				<resources os="SunOS" arch="x86_64">
					<jar href="joal-natives-solaris-amd64.jar" />
					<jar href="jogl-all-natives-solaris-amd64.jar" />
					<jar href="gluegen-rt-natives-solaris-amd64.jar" />
				</resources>
				<resources os="Mac OS X" arch="i386">
					<jar href="joal-natives-macosx-universal.jar" />
					<jar href="jogl-all-natives-macosx-universal.jar" />
					<jar href="gluegen-rt-natives-macosx-universal.jar" />
				</resources>
				<resources os="Mac OS X" arch="x86_64">
					<jar href="joal-natives-macosx-universal.jar" />
					<jar href="jogl-all-natives-macosx-universal.jar" />
					<jar href="gluegen-rt-natives-macosx-universal.jar" />
				</resources>
				<resources os="Windows" arch="x86">
					<jar href="joal-natives-windows-i586.jar" />
					<jar href="jogl-all-natives-windows-i586.jar" />
					<jar href="gluegen-rt-natives-windows-i586.jar" />
				</resources>
				<resources os="Windows" arch="amd64">
					<jar href="joal-natives-windows-amd64.jar" />
					<jar href="jogl-all-natives-windows-amd64.jar" />
					<jar href="gluegen-rt-natives-windows-amd64.jar" />
				</resources>
				<resources os="Windows" arch="x86_64">
					<jar href="joal-natives-windows-amd64.jar" />
					<jar href="jogl-all-natives-windows-amd64.jar" />
					<jar href="gluegen-rt-natives-windows-amd64.jar" />
				</resources>
				<application-desc main-class="${tuer-main-class}" />
			</jnlp>
			]]>
		</echo>
		<echo file="${destdir}/${jfpsm-jnlp-filename}">
			<![CDATA[<?xml version="1.0" encoding="utf-8"?>
			<jnlp spec="1.0+" codebase="${codebase-url}" href="${jfpsm-jnlp-filename}">
				<information>
					<title>${jfpsm-application-name}</title>
					<vendor>${vendor}</vendor>
					<homepage href="${homepage-url}"/>
					<description>Java First Person Shooter Maker</description>
					<description kind="short">JFPSM</description>
					<offline-allowed/>
				</information>
				<security>
					<all-permissions />
				</security>
				<update check="always" policy="always"/>
				<resources>
					<j2se version="1.7+" href="http://java.sun.com/products/autodl/j2se" initial-heap-size="32m" max-heap-size="512m" java-vm-args="-XX:MaxDirectMemorySize=128M"/>
					<property name="sun.nio.MaxDirectMemorySize" value="128M"/>
					<property name="sun.java2d.noddraw" value="true"/>
					<property name="sun.java2d.d3d" value="false"/>
					<property name="sun.java2d.opengl" value="false"/>
			        <property name="java.ext.dirs" value="" />
					<property name="sun.awt.noerasebackground" value="true"/>
					<jar href="${jfpsm-jar-filename}" download="eager" main="true"/>
					<jar href="ardor3d-collada-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-core-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-math-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-savable-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-jogl-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="ardor3d-ui-${ardor3d-version}.jar" download="eager" main="false"/>
					<jar href="fettle-0.7.0.jar" download="eager" main="false"/>
					<jar href="guava-14.0.1.jar" download="eager" main="false"/>
					<jar href="CodecJOrbis.jar" download="eager" main="false"/>
					<jar href="LibraryJavaSound.jar" download="eager" main="false"/>
					<jar href="LibraryJOAL.jar" download="eager" main="false"/>
					<jar href="SoundSystem.jar" download="eager" main="false"/>
					<jar href="gluegen-rt.jar" download="eager" main="false"/>
					<jar href="joal.jar" download="eager" main="false"/>
					<jar href="jogl-all.jar" download="eager" main="false"/>
				</resources>
				<resources os="Linux" arch="i386">
					<jar href="joal-natives-linux-i586.jar" />
					<jar href="jogl-all-natives-linux-i586.jar" />
					<jar href="gluegen-rt-natives-linux-i586.jar" />
				</resources>
				<resources os="Linux" arch="x86">
					<jar href="joal-natives-linux-i586.jar" />
					<jar href="jogl-all-natives-linux-i586.jar" />
					<jar href="gluegen-rt-natives-linux-i586.jar" />
				</resources>
				<resources os="Linux" arch="amd64">
					<jar href="joal-natives-linux-amd64.jar" />
					<jar href="jogl-all-natives-linux-amd64.jar" />
					<jar href="gluegen-rt-natives-linux-amd64.jar" />
				</resources>
				<resources os="Linux" arch="x86_64">
					<jar href="joal-natives-linux-amd64.jar" />
					<jar href="jogl-all-natives-linux-amd64.jar" />
					<jar href="gluegen-rt-natives-linux-amd64.jar" />
				</resources>
				<resources os="SunOS" arch="sparc">
					<jar href="joal-natives-solaris-sparc.jar" />
					<jar href="jogl-all-natives-solaris-sparc.jar" />
					<jar href="gluegen-rt-natives-solaris-sparc.jar" />
				</resources>
				<resources os="SunOS" arch="sparcv9">
					<jar href="joal-natives-solaris-sparcv9.jar" />
					<jar href="jogl-all-natives-solaris-sparcv9.jar" />
					<jar href="gluegen-rt-natives-solaris-sparcv9.jar" />
				</resources>
				<resources os="SunOS" arch="x86">
					<jar href="joal-natives-solaris-i586.jar" />
					<jar href="jogl-all-natives-solaris-i586.jar" />
					<jar href="gluegen-rt-natives-solaris-i586.jar" />
				</resources>
				<resources os="SunOS" arch="amd64">
					<jar href="joal-natives-solaris-amd64.jar" />
					<jar href="jogl-all-natives-solaris-amd64.jar" />
					<jar href="gluegen-rt-natives-solaris-amd64.jar" />
				</resources>
				<resources os="SunOS" arch="x86_64">
					<jar href="joal-natives-solaris-amd64.jar" />
					<jar href="jogl-all-natives-solaris-amd64.jar" />
					<jar href="gluegen-rt-natives-solaris-amd64.jar" />
				</resources>
				<resources os="Mac OS X" arch="i386">
					<jar href="joal-natives-macosx-universal.jar" />
					<jar href="jogl-all-natives-macosx-universal.jar" />
					<jar href="gluegen-rt-natives-macosx-universal.jar" />
				</resources>
				<resources os="Mac OS X" arch="x86_64">
					<jar href="joal-natives-macosx-universal.jar" />
					<jar href="jogl-all-natives-macosx-universal.jar" />
					<jar href="gluegen-rt-natives-macosx-universal.jar" />
				</resources>
				<resources os="Windows" arch="x86">
					<jar href="joal-natives-windows-i586.jar" />
					<jar href="jogl-all-natives-windows-i586.jar" />
					<jar href="gluegen-rt-natives-windows-i586.jar" />
				</resources>
				<resources os="Windows" arch="amd64">
					<jar href="joal-natives-windows-amd64.jar" />
					<jar href="jogl-all-natives-windows-amd64.jar" />
					<jar href="gluegen-rt-natives-windows-amd64.jar" />
				</resources>
				<resources os="Windows" arch="x86_64">
					<jar href="joal-natives-windows-amd64.jar" />
					<jar href="jogl-all-natives-windows-amd64.jar" />
					<jar href="gluegen-rt-natives-windows-amd64.jar" />
				</resources>
				<application-desc main-class="${jfpsm-main-class}" />
			</jnlp>
			]]>
		</echo>
	</target>
	<!-- ================================================================= -->
	<!-- Create archive                                                    -->
	<!-- ================================================================= -->
	<target name="create-archive">
		<delete file="${destdir}/${tuer-zip-filename}" failonerror="false" />
		<!-- Creates the archive -->
		<zip destfile="${destdir}/${tuer-zip-filename}">
			<fileset dir="." excludes="**/*.class,**/target/*.jar,**/target/*.jnlp,${keystore},**/*.py"/>
		</zip>
	</target>
	<!-- ================================================================= -->
	<!-- Create RPM                                                        -->
	<!-- ================================================================= -->
	<target name="create-rpm">
		<!--<redline:rpm group="Games" name="tuer" version="0" destination="${destdir}">
		    
		</redline:rpm>-->
	</target>
	<!-- ================================================================= -->
	<!-- Upload                                                            -->
	<!-- ================================================================= -->
	<target name="upload">
		<!-- Loads jsch-0.1.50.jar (which is required to use the optional scp task) into the system classloader
		     (trick provided by Alexey Razgulyaev: http://razgulyaev.blogspot.fr/2012/04/ant-how-to-load-library-on-fly-at.html) -->
		<classloader loader="system" classpath="lib/ant/jsch-0.1.50.jar"/>
		<!-- Gets the SFTP account's password from the end user's input -->
		<input message="Please enter the password:" addproperty="sftp-password"/>
		<!-- There is no way to delete obsolete files with Ant SCP, you have to do it yourself -->
		<!-- Uploads the archive onto the SFTP server in the Project file release -->
		<scp sftp="true" trust="true" todir="${sftp-userid}:${sftp-password}@${sftp-pfs-server}:${sftp-pfs-remotedir}">
			<fileset file="${destdir}/${tuer-zip-filename}" />
		</scp>
		<!-- Uploads the files onto the SFTP server in the Project Web Space -->
		<scp sftp="true" trust="true" todir="${sftp-userid}:${sftp-password}@${sftp-server}:${sftp-remotedir}">
			<fileset dir="${destdir}" includes="**/*" excludes="${tuer-zip-filename}" />
		</scp>
	</target>
	<!-- ================================================================= -->
	<!-- Clean                                                             -->
	<!-- ================================================================= -->
	<target name="clean" description="Deletes the java archive and the .class files">
		<delete failonerror="false">
			<fileset dir="${bindir}" includes="**/*.class" />
		</delete>
		<delete file="${keystore}" failonerror="false" />
		<delete file="${destdir}/${tuer-zip-filename}" failonerror="false" />
		<delete file="${destdir}/${tuer-jnlp-filename}" failonerror="false" />
		<delete file="${destdir}/${jfpsm-jnlp-filename}" failonerror="false" />
		<delete file="lib/joal/openal-soft-1.15.1-bin.zip" failonerror="false" />
		<delete failonerror="false">
			<dirset dir="lib/joal/openal-soft-1.15.1-bin" />
		</delete>
		<delete failonerror="false">
			<path refid="project.signed.jars.path"/>
		</delete>
	</target>
	<!-- =================================================================== -->
	<!-- Run Targets                                                         -->
	<!-- =================================================================== -->
	<target name="run-jfpsm" description="Runs JFPSM">
		<java classname="${jfpsm-main-class}"
			  fork="true"
			  dir="${bindir}"
			  failonerror="true">
			<classpath refid="project.class.path"/>
			<jvmarg value="-splash:${jfpsm-splashscreen-image}"/>
			<jvmarg value="-Xmx512m"/>
			<jvmarg value="-XX:MaxDirectMemorySize=128M"/>
			<jvmarg value="-Djava.ext.dirs="/>
		</java>
	</target>
	<target name="run-tuer" description="Runs TUER">
		<java classname="${tuer-main-class}"
			  fork="true"
			  dir="${bindir}"
			  failonerror="true">
			<classpath refid="project.class.path"/>
			<jvmarg value="-Xmx256m"/>
			<jvmarg value="-XX:MaxDirectMemorySize=128M"/>
			<jvmarg value="-Djava.ext.dirs="/>
		</java>
	</target>
</project>