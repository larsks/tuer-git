<?xml version="1.0"?>

<!-- ===================================================================== -->
<!-- TUER                                                                  -->
<!-- Ant 1.5 build file                                                    -->
<!-- ===================================================================== -->

<project name="TUER" default="build" basedir=".">

    <property name="basedir" value="."/>
    <property name="srcdir" value="."/>
    <property name="destdir" value="."/>
	<property name="alias" value="gouessej"/>
	<property name="keystore" value="key"/>

    <!-- Allow user to override properties without editing this file -->
    <property file="${user.home}/.ant.properties" />

	<path id="project.class.path">
	    <!-- N.B: do not add java.class.path -->
	    <pathelement path="${destdir}"/>	    
	    <pathelement location="lib/jogl/jogl-all.jar"/>
	    <pathelement location="lib/jogl/gluegen-rt.jar"/>	        
	</path>
	<target name="check-java-version" description="Checks the Java version">
	    <fail message="Please use Java SDK 1.7 or higher.">
	        <condition>
	            <not>                   
	                <or>
	                    <equals arg1="${ant.java.version}" arg2="1.7" />
	                    <equals arg1="${ant.java.version}" arg2="1.8" />
	                </or>                                           
	            </not>
	        </condition>
	    </fail>
	</target>
    <!-- ================================================================= -->
    <!-- Compile                                                           -->
    <!-- ================================================================= -->
	<target name="compile" description="Compiles the source code">
        <javac srcdir="${srcdir}"       	   
               destdir="${destdir}"
               debug="on" >
        	<classpath refid="project.class.path"/>
            <include name="**/*.java"/>
        </javac>
    </target>


    <!-- ================================================================= -->
    <!-- Clean                                                             -->
    <!-- ================================================================= -->
    <target name="clean" description="Deletes the snap directory, the java archive and the .class files">
    	<delete failonerror="false">
    		<fileset file="${keystore}" />
    	    <fileset dir="${destdir}" includes="**/*.class" />
    		<fileset file="${destdir}/tuer.jar" />
    		<fileset file="${destdir}/jogl-all.jar"/>
    		<fileset file="${destdir}/jogl-all-natives-linux-amd64.jar"/>
    		<fileset file="${destdir}/jogl-all-natives-linux-i586.jar"/>
    		<fileset file="${destdir}/jogl-all-natives-macosx-ppc.jar"/>
    		<fileset file="${destdir}/jogl-all-natives-macosx-universal.jar"/>
    		<fileset file="${destdir}/jogl-all-natives-windows-amd64.jar"/>
    		<fileset file="${destdir}/jogl-all-natives-windows-i586.jar"/>
    		<fileset file="${destdir}/gluegen-rt.jar"/>
    		<fileset file="${destdir}/gluegen-rt-natives-linux-amd64.jar"/>
    		<fileset file="${destdir}/gluegen-rt-natives-linux-i586.jar"/>
    		<fileset file="${destdir}/gluegen-rt-natives-macosx-ppc.jar"/>
    		<fileset file="${destdir}/gluegen-rt-natives-macosx-universal.jar"/>
    		<fileset file="${destdir}/gluegen-rt-natives-windows-amd64.jar"/>
    		<fileset file="${destdir}/gluegen-rt-natives-windows-i586.jar"/>
    	</delete>
    	<delete dir="${destdir}/snap" failonerror="false" />
    	<delete dir="${destdir}/obj" failonerror="false" />
    	<delete dir="${destdir}/xml" failonerror="false" />
    	<delete dir="${destdir}/data" failonerror="false" />
    	<!-- delete only the generated files, not the artworks -->
    	<!-- generated textures -->
    	<delete file="${destdir}/texture/ceilTexture.png" failonerror="false" />
    	<delete file="${destdir}/texture/floorTexture.png" failonerror="false" />
    	<delete file="${destdir}/texture/wallTexture0.png" failonerror="false" />   	
    </target>

	<!-- ================================================================= -->
	<!-- Dist                                                              -->
	<!-- ================================================================= -->
	<target name="dist" depends="compile" description="Creates the java archive">
		<jar destfile="tuer.jar" basedir="${destdir}" 
			includes="**/*.class" 
			compress="false">
			<include name="**/*.png" />
			<include name="**/*.jpg" />
			<include name="**/*.gif" />
			<include name="**/*.data"/>
			<include name="**/*.txt" />
			<include name="**/*.ogg" />			
			<include name="**/*.xml" />
			<!-- generated textures -->
			<exclude name="**/texture/ceilTexture.png" />
			<exclude name="**/texture/floorTexture.png" />
			<exclude name="**/texture/wallTexture0.png" />
			<!-- generated maps -->
			<exclude name="**/texture/cellsmap.png" />
			<exclude name="**/texture/worldmap.gif" />
			<!-- MD3 loader -->
			<exclude name="**/md3/*.*" />
			<!-- documentation and license-->
			<exclude name="**/contents.txt" />
			<exclude name="**/gpl.txt" />
			<exclude name="**/readme.txt" />
			<!-- ANT file -->
			<exclude name="**/build.xml" />
			<manifest>
			    <attribute name="Main-Class" value="connection.GameServiceProvider"/>
			</manifest>
		</jar>
		<copy file="lib/jogl/jogl-all.jar" todir="${destdir}"/>
		<copy file="lib/jogl/jogl-all-natives-linux-amd64.jar" todir="${destdir}"/>
		<copy file="lib/jogl/jogl-all-natives-linux-i586.jar" todir="${destdir}"/>
		<copy file="lib/jogl/jogl-all-natives-macosx-ppc.jar" todir="${destdir}"/>
		<copy file="lib/jogl/jogl-all-natives-macosx-universal.jar" todir="${destdir}"/>
		<copy file="lib/jogl/jogl-all-natives-windows-amd64.jar" todir="${destdir}"/>
		<copy file="lib/jogl/jogl-all-natives-windows-i586.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt-natives-linux-amd64.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt-natives-linux-i586.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt-natives-macosx-ppc.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt-natives-macosx-universal.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt-natives-windows-amd64.jar" todir="${destdir}"/>
		<copy file="lib/jogl/gluegen-rt-natives-windows-i586.jar" todir="${destdir}"/>
	</target>
	
	<!-- ================================================================= -->
	<!-- Sign                                                              -->
	<!-- ================================================================= -->
	<target name="sign" depends="dist" description="Sign the java archive">
		<input message="Please enter the store pass:" addproperty="storepass"/>
		<genkey alias="${alias}" storepass="${storepass}" keystore="${keystore}" >
		    <dname>
		        <param name="CN" value="${vendor}"/>
		        <param name="OU" value="Engineer"/>
		        <param name="O"  value="FGF"/>
		        <param name="C"  value="FR"/>
		        <param name="L"  value="PARIS"/>
		        <param name="S"  value="FRANCE"/>
		    </dname>
		</genkey>
		<signjar alias="${alias}" storepass="${storepass}" keystore="${keystore}" lazy="false"> 
		    <path>
		    	<fileset file="${destdir}/tuer.jar"/>
		    	<fileset file="${destdir}/jogl-all.jar"/>
		    	<fileset file="${destdir}/jogl-all-natives-linux-amd64.jar"/>
		    	<fileset file="${destdir}/jogl-all-natives-linux-i586.jar"/>
		    	<fileset file="${destdir}/jogl-all-natives-macosx-ppc.jar"/>
		    	<fileset file="${destdir}/jogl-all-natives-macosx-universal.jar"/>
		    	<fileset file="${destdir}/jogl-all-natives-windows-amd64.jar"/>
		    	<fileset file="${destdir}/jogl-all-natives-windows-i586.jar"/>
		    	<fileset file="${destdir}/gluegen-rt.jar"/>
		    	<fileset file="${destdir}/gluegen-rt-natives-linux-amd64.jar"/>
		    	<fileset file="${destdir}/gluegen-rt-natives-linux-i586.jar"/>
		    	<fileset file="${destdir}/gluegen-rt-natives-macosx-ppc.jar"/>
		    	<fileset file="${destdir}/gluegen-rt-natives-macosx-universal.jar"/>
		    	<fileset file="${destdir}/gluegen-rt-natives-windows-amd64.jar"/>
		    	<fileset file="${destdir}/gluegen-rt-natives-windows-i586.jar"/>
		    </path>
		</signjar>
	</target>
	
    <!-- =================================================================== -->
    <!-- Build                                                               -->
    <!-- =================================================================== -->
    <target name="build" depends="clean, compile, run-datapreprocessor, dist"
        description="Performs a clean build of the source code and create the java archive"/>


    <!-- =================================================================== -->
    <!-- Run Targets                                                         -->
    <!-- =================================================================== -->  
	<target name="run-datapreprocessor" description="Runs the program that generates the tiles and the cells">
		    <mkdir dir="${destdir}/obj" />
		    <mkdir dir="${destdir}/xml" />
			<mkdir dir="${destdir}/data" />
	        <java classname="connection.DataPreprocessor"
		              fork="true"
		              dir="${destdir}"
		              failonerror="true"
		              >   
	        	    <classpath refid="project.class.path"/>
	<!-- The program uses only 512 MB but it might need more on bigger maps -->
	        	    <jvmarg value="-Xmx1536m"/>       	    
		        	<arg value="texture/worldmap.gif"/>
		        	<arg value="data/worldmap.data"/>
		        	<arg value="data/rocketLauncher.data"/>
		        	<arg value="data/binaryWorldmap.data"/>
		        	<arg value="data/bot.data"/>
		        	<arg value="data/unbreakableObject.data"/>	        	
		        	<arg value="data/vendingMachine.data"/>
		        	<arg value="data/lamp.data"/>
		        	<arg value="data/chair.data"/>
		        	<arg value="data/flower.data"/>
		        	<arg value="data/table.data"/>
		        	<arg value="data/bonsai.data"/>
		        	<arg value="data/rocket.data"/>
		        	<arg value="data/explosion.data"/>
		        	<arg value="data/impact.data"/>
		        	<arg value="data/healthPowerUp.data"/>
		        	<arg value="xml/itemList.xml"/>
		        	<arg value="data/crosshair.data"/>
		        	<arg value="data/sphericalBeast.data"/>
		        	<arg value="data/network.data"/>
	        	    <arg value="obj/LID0"/>
	        	    <arg value="texture/wallTexture.png"/>
	        	    <arg value="texture/rocketLauncher.png"/>
	        	    <arg value="obj/rocketLauncher"/>
	        	    <arg value="obj/rocket"/>
	        	    <arg value="texture/objects.png"/>
	        	    <arg value="obj/unbreakableObject"/>	        	
	        		<arg value="obj/vendingMachine"/>
	        		<arg value="obj/lamp"/>
	        		<arg value="obj/chair"/>
	        		<arg value="obj/flower"/>
	        		<arg value="obj/table"/>
	        		<arg value="obj/bonsai"/>
	        	    <arg value="LID0.mtl"/>
	        	    <arg value="texture/ceilTexture.png"/>
	        	    <arg value="texture/floorTexture.png"/>
	        	    <arg value="texture/wallTexture0.png"/>
		</java>
	</target>
	<target name="run-tuer" description="Runs the game TUER">
	    <java classname="connection.GameServiceProvider"
	              fork="true"
	              dir="${destdir}"
	              failonerror="true"
	              >
	    	<classpath refid="project.class.path"/>
	    </java>
	</target>
</project>
