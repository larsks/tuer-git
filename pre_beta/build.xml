<?xml version="1.0"?>

<!-- ===================================================================== -->
<!-- TUER                                                                  -->
<!-- Ant 1.5 build file                                                    -->
<!-- ===================================================================== -->

<project name="TUER" default="build" basedir=".">
	<property name="destdir" value="."/>
	<property name="srcdir" value="."/>
	<condition property="isSolaris_i586">
		<and>
		    <os name="SunOS" />
			<or>
				<os arch="i386" />
				<os arch="i586" />
			</or>
		</and>
	</condition>
	<condition property="isSolaris_amd64">
		<and>
		    <os name="SunOS" />
			<os arch="amd64" />
		</and>
	</condition>
	<condition property="isSolaris_sparc">
		<and>
		    <os name="SunOS" />
			<os arch="sparc" />
		</and>
	</condition>
	<condition property="isSolaris_sparcv9">
		<and>
			<os name="SunOS" />
			<os arch="sparcv9" />
		</and>
	</condition>
	<condition property="isWindows_amd64">
		<and>
	        <os family="windows" />
		    <os arch="amd64" />
		</and>
	</condition>
	<condition property="isWindows_i586">
		<and>
		    <os family="windows" />
			<or>
				<os arch="i386" />
				<os arch="i586" />
			</or>
		</and>
	</condition>
	<condition property="isMac_ppc">
		<and>
	        <os family="mac" />
			<os arch="ppc" />
		</and>
	</condition>
	<condition property="isMac_universal">
		<and>
		    <os family="mac" />
			<not>
			    <os arch="ppc" />
			</not>
		</and>
	</condition>
	<condition property="isLinux_amd64">
		<and>
		    <os name="linux" />
		    <os arch="amd64" />
		</and>
	</condition>
	<condition property="isLinux_i586">
		<and>
		    <os name="linux" />
			<or>
			    <os arch="i386" />
				<os arch="i586" />
			</or>
		</and>
	</condition>
	<path id="project.class.path">
	    <!-- N.B: do not add java.class.path -->
		<pathelement path="${destdir}"/>
		<pathelement location="../ardor3d-animations/target/ardor3d-animations-0.6-SNAPSHOT.jar"/>
		<pathelement location="../ardor3d-collada/target/ardor3d-collada-0.6-SNAPSHOT.jar"/>
		<pathelement location="../ardor3d-core/target/ardor3d-core-0.6-SNAPSHOT.jar"/>
		<pathelement location="../ardor3d-core/lib/google/google-collect-1.0-rc1.jar"/>
		<pathelement location="../ardor3d-core/lib/google/guice-1.0.jar"/>
		<pathelement location="../ardor3d-awt/target/ardor3d-awt-0.6-SNAPSHOT.jar"/>
		<pathelement location="../ardor3d-jogl/target/ardor3d-jogl-0.6-SNAPSHOT.jar"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl.jar"/>
		<!-- uncomment these lines when the ticket 144 is fixed -->
		<!--<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-linux-i586.jar" if="isLinux_i586"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-linux-amd64.jar" if="isLinux_amd64"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-windows-i586.jar" if="isWindows_i586"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-windows-i586.jar" if="isWindows_amd64"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-macosx-ppc.jar" if="isMac_ppc"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-macosx-universal.jar" if="isMac_universal"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-solaris-i586.jar" if="isSolaris_i586"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-solaris-amd64.jar" if="isSolaris_amd64"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-solaris-sparc.jar" if="isSolaris_sparc"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/jogl-natives-solaris-sparcv9.jar" if="isSolaris_sparcv9"/>-->
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt.jar"/>
		<!-- uncomment these lines when the ticket 144 is fixed -->
		<!--<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-linux-i586.jar" if="isLinux_i586"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-linux-amd64.jar" if="isLinux_amd64"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-windows-i586.jar" if="isWindows_i586"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-windows-i586.jar" if="isWindows_amd64"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-macosx-ppc.jar" if="isMac_ppc"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-macosx-universal.jar" if="isMac_universal"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-solaris-i586.jar" if="isSolaris_i586"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-solaris-amd64.jar" if="isSolaris_amd64"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-solaris-sparc.jar" if="isSolaris_sparc"/>
		<pathelement location="../ardor3d-jogl/lib/jogl/gluegen-rt-natives-solaris-sparcv9.jar" if="isSolaris_sparcv9"/>-->
		<pathelement location="../ardor3d-ui/target/ardor3d-ui-0.6-SNAPSHOT.jar"/>
		<!-- Paul Lamb 3D Sound System -->
		<pathelement location="./SoundSystem.jar"/>
		<pathelement location="./LibraryJavaSound.jar"/>
	    <pathelement location="./CodecJOrbis.jar"/>
	</path>
	<!-- ================================================================= -->
	<!-- Compile                                                           -->
	<!-- ================================================================= -->
	<target name="compile" description="Compiles the source code">
	    <javac srcdir="${srcdir}"       	   
	           destdir="${destdir}"
	           debug="on" >
	    	<classpath refid="project.class.path"/>
	        <include name="**/*.java"/>
	    </javac>
	</target>
	<!-- =================================================================== -->
	<!-- Build                                                               -->
	<!-- =================================================================== -->
	<target name="build" depends="clean,compile,dist" description="Performs a clean build of the source code and create the JAR"/>
	<!-- ================================================================= -->
	<!-- Dist                                                              -->
	<!-- ================================================================= -->
	<target name="dist" depends="compile" description="Creates and signs the java archive">
	    <delete file="key" failonerror="false" />
		<input message="Please enter the store pass:" addproperty="storepass"/>
		<genkey alias="gouessej" storepass="${storepass}" keystore="key" >
			<dname>
				<param name="CN" value="Julien GOUESSE"/>
				<param name="OU" value="Engineer"/>
				<param name="O"  value="FGF"/>
				<param name="C"  value="FR"/>
				<param name="L"  value="PARIS"/>
				<param name="S"  value="FRANCE"/>
			</dname>
		</genkey>
		<jar destfile="${destdir}/jfpsm.jar" basedir="${destdir}" 
			includes="**/*.class" 
			compress="false">
			<exclude name="**/gpl.txt" />
			<!-- the collada models are not yet used -->
			<exclude name="**/dae/*" />
			<!-- ANT file -->
			<exclude name="**/build.xml" />
			<manifest>
				<attribute name="Main-Class" value="jfpsm.MainWindow"/>
			</manifest>
		</jar>
		<jar destfile="${destdir}/tuer.jar" basedir="${destdir}" 
			includes="**/*.class"
			compress="false">
			<include name="**/*.png" />
			<!-- TUER does not need JFPSM classes -->
			<exclude name="**/jfpsm/*.class" />
			<exclude name="**/connection/*.class" />
			<!-- the collada models are not yet used -->
			<exclude name="**/dae/*" />
			<exclude name="**/gpl.txt" />
			<!-- ANT file -->
			<exclude name="**/build.xml" />
			<manifest>
				<attribute name="Main-Class" value="engine.TuerServiceProvider"/>
			</manifest>
		</jar>
		<signjar alias="gouessej" keystore="key" storepass="gbilysm" lazy="false" >
		    <path>
		    	<fileset file="../ardor3d-core/lib/google/guice-1.0.jar" />
		    	<fileset file="../ardor3d-core/lib/google/google-collect-1.0-rc1.jar" />
		    	<fileset file="../ardor3d-animations/target/ardor3d-animations-0.6-SNAPSHOT.jar" />
		    	<fileset file="../ardor3d-collada/target/ardor3d-collada-0.6-SNAPSHOT.jar" />
		    	<fileset file="../ardor3d-core/target/ardor3d-core-0.6-SNAPSHOT.jar" />
		    	<fileset file="../ardor3d-awt/target/ardor3d-awt-0.6-SNAPSHOT.jar" />
		    	<fileset file="../ardor3d-jogl/target/ardor3d-jogl-0.6-SNAPSHOT.jar" />
		    	<fileset file="../ardor3d-ui/target/ardor3d-ui-0.6-SNAPSHOT.jar" />
		      	<fileset file="${destdir}/tuer.jar"/>
		        <fileset file="${destdir}/jfpsm.jar"/>
		    	<!-- Paul Lamb 3D Sound System -->
		    	<fileset file="./SoundSystem.jar"/>
		    	<fileset file="./LibraryJavaSound.jar"/>
		    	<fileset file="./CodecJOrbis.jar"/>
		    </path>
		</signjar>
	</target>
	<!-- ================================================================= -->
	<!-- Deploy                                                            -->
	<!-- ================================================================= -->
	<target name="deploy" depends="dist" description="Puts all signed JARs and all JNLP files onto the server">
	    <!-- TODO: use scp task to do it -->
	</target>
	<!-- ================================================================= -->
	<!-- Clean                                                             -->
	<!-- ================================================================= -->
	<target name="clean" description="Deletes the java archive and the .class files">
	  	<delete>
	  		<fileset file="key" />
	   	    <fileset dir="${destdir}" includes="**/*.class"/>
	  		<fileset file="${destdir}/tuer.jar"/>
	  		<fileset file="${destdir}/jfpsm.jar"/>
	   	</delete>
	</target>
	<!-- =================================================================== -->
	<!-- Run Targets                                                         -->
	<!-- =================================================================== -->  
	<target name="run-jfpsm" description="Runs JFPSM">
		<java classname="connection.JFPSMServiceProvider"
			  fork="true"
			  dir="${destdir}"
			  failonerror="true">
			<classpath refid="project.class.path"/>
		</java>
	</target>
	<target name="run-tuer" description="Runs TUER">
		<java classname="engine.Ardor3DGameServiceProvider"
			  fork="true"
			  dir="${destdir}"
			  failonerror="true">
			<classpath refid="project.class.path"/>
		</java>
	</target>
</project>